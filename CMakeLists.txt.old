cmake_minimum_required(VERSION 3.17)
project(commotalkie)

set(CMAKE_CXX_STANDARD 20)

add_executable(commotalkie main.cpp)

enable_testing()

include_directories(SYSTEM $ENV{CPPUTEST_HOME})
include_directories(include/message)
include_directories(test/mock/message)

add_subdirectory(include/message)

add_library(PackingTest test/PackingTest.cpp)
add_library(ValidatingTest test/ValidatingTest.cpp)

# add cpputest library
add_library(imp_cpputest STATIC IMPORTED)
set_property(TARGET imp_cpputest PROPERTY
        IMPORTED_LOCATION /usr/local/lib/libCppUTest.a)

set(SOURCE_FILES
        test/PackingTest.cpp
        test/ValidatingTest.cpp)

add_executable(unit_test_files ${SOURCE_FILES})
add_executable(RunAllTests test/RunAllTests.cpp)

add_test(NAME run_unit_test COMMAND unit_test_files)

target_link_libraries(RunAllTests imp_cpputest)